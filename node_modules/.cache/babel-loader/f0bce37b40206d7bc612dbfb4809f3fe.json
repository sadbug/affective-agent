{"ast":null,"code":"/**\n * JSON Format Plugin\n *\n * @module plugins/json\n * @license [MIT]{@link https://github.com/archiverjs/node-archiver/blob/master/LICENSE}\n * @copyright (c) 2012-2014 Chris Talkington, contributors.\n */\nvar inherits = require('util').inherits;\n\nvar Transform = require('readable-stream').Transform;\n\nvar crc32 = require('buffer-crc32');\n\nvar util = require('archiver-utils');\n/**\n * @constructor\n * @param {(JsonOptions|TransformOptions)} options\n */\n\n\nvar Json = function Json(options) {\n  if (!(this instanceof Json)) {\n    return new Json(options);\n  }\n\n  options = this.options = util.defaults(options, {});\n  Transform.call(this, options);\n  this.supports = {\n    directory: true,\n    symlink: true\n  };\n  this.files = [];\n};\n\ninherits(Json, Transform);\n/**\n * [_transform description]\n *\n * @private\n * @param  {Buffer}   chunk\n * @param  {String}   encoding\n * @param  {Function} callback\n * @return void\n */\n\nJson.prototype._transform = function (chunk, encoding, callback) {\n  callback(null, chunk);\n};\n/**\n * [_writeStringified description]\n *\n * @private\n * @return void\n */\n\n\nJson.prototype._writeStringified = function () {\n  var fileString = JSON.stringify(this.files);\n  this.write(fileString);\n};\n/**\n * [append description]\n *\n * @param  {(Buffer|Stream)}   source\n * @param  {EntryData}   data\n * @param  {Function} callback\n * @return void\n */\n\n\nJson.prototype.append = function (source, data, callback) {\n  var self = this;\n  data.crc32 = 0;\n\n  function onend(err, sourceBuffer) {\n    if (err) {\n      callback(err);\n      return;\n    }\n\n    data.size = sourceBuffer.length || 0;\n    data.crc32 = crc32.unsigned(sourceBuffer);\n    self.files.push(data);\n    callback(null, data);\n  }\n\n  if (data.sourceType === 'buffer') {\n    onend(null, source);\n  } else if (data.sourceType === 'stream') {\n    util.collectStream(source, onend);\n  }\n};\n/**\n * [finalize description]\n *\n * @return void\n */\n\n\nJson.prototype.finalize = function () {\n  this._writeStringified();\n\n  this.end();\n};\n\nmodule.exports = Json;\n/**\n * @typedef {Object} JsonOptions\n * @global\n */","map":{"version":3,"names":["inherits","require","Transform","crc32","util","Json","options","defaults","call","supports","directory","symlink","files","prototype","_transform","chunk","encoding","callback","_writeStringified","fileString","JSON","stringify","write","append","source","data","self","onend","err","sourceBuffer","size","length","unsigned","push","sourceType","collectStream","finalize","end","module","exports"],"sources":["/Users/andrejsmolencev/Desktop/scorm-generator/node_modules/archiver/lib/plugins/json.js"],"sourcesContent":["/**\n * JSON Format Plugin\n *\n * @module plugins/json\n * @license [MIT]{@link https://github.com/archiverjs/node-archiver/blob/master/LICENSE}\n * @copyright (c) 2012-2014 Chris Talkington, contributors.\n */\nvar inherits = require('util').inherits;\nvar Transform = require('readable-stream').Transform;\n\nvar crc32 = require('buffer-crc32');\nvar util = require('archiver-utils');\n\n/**\n * @constructor\n * @param {(JsonOptions|TransformOptions)} options\n */\nvar Json = function(options) {\n  if (!(this instanceof Json)) {\n    return new Json(options);\n  }\n\n  options = this.options = util.defaults(options, {});\n\n  Transform.call(this, options);\n\n  this.supports = {\n    directory: true,\n    symlink: true\n  };\n\n  this.files = [];\n};\n\ninherits(Json, Transform);\n\n/**\n * [_transform description]\n *\n * @private\n * @param  {Buffer}   chunk\n * @param  {String}   encoding\n * @param  {Function} callback\n * @return void\n */\nJson.prototype._transform = function(chunk, encoding, callback) {\n  callback(null, chunk);\n};\n\n/**\n * [_writeStringified description]\n *\n * @private\n * @return void\n */\nJson.prototype._writeStringified = function() {\n  var fileString = JSON.stringify(this.files);\n  this.write(fileString);\n};\n\n/**\n * [append description]\n *\n * @param  {(Buffer|Stream)}   source\n * @param  {EntryData}   data\n * @param  {Function} callback\n * @return void\n */\nJson.prototype.append = function(source, data, callback) {\n  var self = this;\n\n  data.crc32 = 0;\n\n  function onend(err, sourceBuffer) {\n    if (err) {\n      callback(err);\n      return;\n    }\n\n    data.size = sourceBuffer.length || 0;\n    data.crc32 = crc32.unsigned(sourceBuffer);\n\n    self.files.push(data);\n\n    callback(null, data);\n  }\n\n  if (data.sourceType === 'buffer') {\n    onend(null, source);\n  } else if (data.sourceType === 'stream') {\n    util.collectStream(source, onend);\n  }\n};\n\n/**\n * [finalize description]\n *\n * @return void\n */\nJson.prototype.finalize = function() {\n  this._writeStringified();\n  this.end();\n};\n\nmodule.exports = Json;\n\n/**\n * @typedef {Object} JsonOptions\n * @global\n */\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIA,QAAQ,GAAGC,OAAO,CAAC,MAAD,CAAP,CAAgBD,QAA/B;;AACA,IAAIE,SAAS,GAAGD,OAAO,CAAC,iBAAD,CAAP,CAA2BC,SAA3C;;AAEA,IAAIC,KAAK,GAAGF,OAAO,CAAC,cAAD,CAAnB;;AACA,IAAIG,IAAI,GAAGH,OAAO,CAAC,gBAAD,CAAlB;AAEA;AACA;AACA;AACA;;;AACA,IAAII,IAAI,GAAG,SAAPA,IAAO,CAASC,OAAT,EAAkB;EAC3B,IAAI,EAAE,gBAAgBD,IAAlB,CAAJ,EAA6B;IAC3B,OAAO,IAAIA,IAAJ,CAASC,OAAT,CAAP;EACD;;EAEDA,OAAO,GAAG,KAAKA,OAAL,GAAeF,IAAI,CAACG,QAAL,CAAcD,OAAd,EAAuB,EAAvB,CAAzB;EAEAJ,SAAS,CAACM,IAAV,CAAe,IAAf,EAAqBF,OAArB;EAEA,KAAKG,QAAL,GAAgB;IACdC,SAAS,EAAE,IADG;IAEdC,OAAO,EAAE;EAFK,CAAhB;EAKA,KAAKC,KAAL,GAAa,EAAb;AACD,CAfD;;AAiBAZ,QAAQ,CAACK,IAAD,EAAOH,SAAP,CAAR;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAG,IAAI,CAACQ,SAAL,CAAeC,UAAf,GAA4B,UAASC,KAAT,EAAgBC,QAAhB,EAA0BC,QAA1B,EAAoC;EAC9DA,QAAQ,CAAC,IAAD,EAAOF,KAAP,CAAR;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;AACA;;;AACAV,IAAI,CAACQ,SAAL,CAAeK,iBAAf,GAAmC,YAAW;EAC5C,IAAIC,UAAU,GAAGC,IAAI,CAACC,SAAL,CAAe,KAAKT,KAApB,CAAjB;EACA,KAAKU,KAAL,CAAWH,UAAX;AACD,CAHD;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAd,IAAI,CAACQ,SAAL,CAAeU,MAAf,GAAwB,UAASC,MAAT,EAAiBC,IAAjB,EAAuBR,QAAvB,EAAiC;EACvD,IAAIS,IAAI,GAAG,IAAX;EAEAD,IAAI,CAACtB,KAAL,GAAa,CAAb;;EAEA,SAASwB,KAAT,CAAeC,GAAf,EAAoBC,YAApB,EAAkC;IAChC,IAAID,GAAJ,EAAS;MACPX,QAAQ,CAACW,GAAD,CAAR;MACA;IACD;;IAEDH,IAAI,CAACK,IAAL,GAAYD,YAAY,CAACE,MAAb,IAAuB,CAAnC;IACAN,IAAI,CAACtB,KAAL,GAAaA,KAAK,CAAC6B,QAAN,CAAeH,YAAf,CAAb;IAEAH,IAAI,CAACd,KAAL,CAAWqB,IAAX,CAAgBR,IAAhB;IAEAR,QAAQ,CAAC,IAAD,EAAOQ,IAAP,CAAR;EACD;;EAED,IAAIA,IAAI,CAACS,UAAL,KAAoB,QAAxB,EAAkC;IAChCP,KAAK,CAAC,IAAD,EAAOH,MAAP,CAAL;EACD,CAFD,MAEO,IAAIC,IAAI,CAACS,UAAL,KAAoB,QAAxB,EAAkC;IACvC9B,IAAI,CAAC+B,aAAL,CAAmBX,MAAnB,EAA2BG,KAA3B;EACD;AACF,CAxBD;AA0BA;AACA;AACA;AACA;AACA;;;AACAtB,IAAI,CAACQ,SAAL,CAAeuB,QAAf,GAA0B,YAAW;EACnC,KAAKlB,iBAAL;;EACA,KAAKmB,GAAL;AACD,CAHD;;AAKAC,MAAM,CAACC,OAAP,GAAiBlC,IAAjB;AAEA;AACA;AACA;AACA"},"metadata":{},"sourceType":"script"}